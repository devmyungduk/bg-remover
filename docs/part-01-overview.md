# Part 1: ì´ë¯¸ì§€ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ (30ë¶„)

### í•™ìŠµ ëª©í‘œ
AI ë°°ê²½ ì œê±° ì•±ì´ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ì „ì²´ íŒŒì´í”„ë¼ì¸ì„ ì´í•´í•©ë‹ˆë‹¤.

---

### ëª©ì°¨
- [1. í”„ë¡œì íŠ¸ êµ¬ì¡°](#1-í”„ë¡œì íŠ¸-êµ¬ì¡°)
- [2. íŒŒì´í”„ë¼ì¸ ê°„ë‹¨ íë¦„](#2-íŒŒì´í”„ë¼ì¸-ê°„ë‹¨-íë¦„)
- [3. íŒŒì´í”„ë¼ì¸ ìƒì„¸ íë¦„](#3-íŒŒì´í”„ë¼ì¸-ìƒì„¸-íë¦„)

---

### 1. í”„ë¡œì íŠ¸ êµ¬ì¡°

```
bg-remover/
â””â”€â”€ frontend/
    â”œâ”€â”€ app/
    â”‚   â”œâ”€â”€ api/comfy/
    â”‚   â”‚   â”œâ”€â”€ upload         # ì´ë¯¸ì§€ ì—…ë¡œë“œ ì—”ë“œí¬ì¸íŠ¸
    â”‚   â”‚   â”œâ”€â”€ prompt         # AI ì‘ì—… ì‹œì‘
    â”‚   â”‚   â”œâ”€â”€ history/[id]   # ì‘ì—… ìƒíƒœ ì¡°íšŒ
    â”‚   â”‚   â””â”€â”€ view           # ê²°ê³¼ ì´ë¯¸ì§€ ì¡°íšŒ
    â”‚   â”œâ”€â”€ page.tsx           # ë©”ì¸ ì»´í¬ë„ŒíŠ¸ (ìš°ë¦¬ ì½”ë“œ)
    â”‚   â”œâ”€â”€ layout.tsx
    â”‚   â””â”€â”€ globals.css
    â”œâ”€â”€ public/
    â”‚   â””â”€â”€ workflows/
    â”‚       â””â”€â”€ bg_remove.json # ComfyUI ì›Œí¬í”Œë¡œ ì„¤ì •
    â””â”€â”€ ...
```

---

### 2. íŒŒì´í”„ë¼ì¸ ê°„ë‹¨ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ğŸ“    â”‚ â”€â†’ â”‚    ğŸ“¤    â”‚ â”€â†’ â”‚    ğŸ¤–    â”‚ â”€â†’ â”‚    ğŸ“Š    â”‚ â”€â†’ â”‚    âœ…    â”‚
â”‚ì´ë¯¸ì§€ì„ íƒâ”‚    â”‚ì„œë²„ ì „ì†¡ â”‚    â”‚ AI ì²˜ë¦¬  â”‚    â”‚ì§„í–‰ë¥ í™•ì¸â”‚    â”‚ê²°ê³¼ë‹¤ìš´ë¡œë“œâ”‚
â”‚(ë¸Œë¼ìš°ì €)â”‚    â”‚(ë¸Œë¼ìš°ì €)â”‚    â”‚(ComfyUI) â”‚    â”‚(ë¸Œë¼ìš°ì €)â”‚    â”‚(ë¸Œë¼ìš°ì €)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### ğŸ“ ì´ë¯¸ì§€ ì„ íƒ (Code Line 119-136)

ì‚¬ìš©ìê°€ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ë©´ íŒŒì¼ í˜•ì‹ê³¼ í¬ê¸°ë¥¼ ê²€ì¦í•œ í›„, ì •ì‚¬ê°í˜•ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë¯¸ë¦¬ë³´ê¸°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.

**í•µì‹¬ ì½”ë“œ**:
```typescript
// Line 123-124: íŒŒì¼ ê²€ì¦
if (!valid.includes(selected.type)) { setError('JPG/PNG/WEBP íŒŒì¼ë§Œ ê°€ëŠ¥'); return; }
if (selected.size > 10 * 1024 * 1024) { setError('10MB ì´í•˜ íŒŒì¼ë§Œ ê°€ëŠ¥'); return; }

// Line 131: ì •ì‚¬ê°í˜• ë³€í™˜ í•¨ìˆ˜ í˜¸ì¶œ
const squareFile = await resizeToSquare(selected);

// Line 133: ë¯¸ë¦¬ë³´ê¸° URL ìƒì„±
const newPreview = URL.createObjectURL(squareFile);
```

---

#### ğŸ“¤ ì„œë²„ ì „ì†¡ (Code Line 139-146)

ë³€í™˜ëœ ì´ë¯¸ì§€ë¥¼ FormDataë¡œ íŒ¨í‚¤ì§•í•˜ì—¬ ComfyUI ì„œë²„ì— ì—…ë¡œë“œí•˜ê³ , ì„œë²„ê°€ ì €ì¥í•œ íŒŒì¼ëª…ì„ ë°›ìŠµë‹ˆë‹¤.

> **FormData**: íŒŒì¼ì„ ì„œë²„ë¡œ ì „ì†¡í•˜ê¸° ìœ„í•œ ì›¹ í‘œì¤€ ë°ì´í„° í¬ë§·  
> **fetch**: ì„œë²„ì™€ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ëŠ” í•¨ìˆ˜ (íƒë°°ì›ì²˜ëŸ¼ ë°ì´í„°ë¥¼ ë°°ë‹¬)

**í•µì‹¬ ì½”ë“œ**:
```typescript
// Line 140-141: FormData ìƒì„± ë° ì—…ë¡œë“œ
const form = new FormData(); 
form.append('image', file);
const res = await fetch('/api/comfy/upload', { method: 'POST', body: form });

// Line 145: ì„œë²„ê°€ ë°˜í™˜í•œ íŒŒì¼ëª…
const data: UploadResponse = await res.json();
return data.name;  // ì˜ˆ: "image_123.png"
```

---

#### ğŸ¤– AI ì²˜ë¦¬ (Code Line 177-186)

ì›Œí¬í”Œë¡œ íŒŒì¼ì„ ë¡œë“œí•˜ì—¬ ì—…ë¡œë“œëœ ì´ë¯¸ì§€ íŒŒì¼ëª…ìœ¼ë¡œ ìˆ˜ì •í•œ í›„, AI ì‘ì—…ì„ ì‹œì‘í•˜ê³  ì‘ì—… IDë¥¼ ë°›ìŠµë‹ˆë‹¤.

**í•µì‹¬ ì½”ë“œ**:
```typescript
// Line 177-179: ì›Œí¬í”Œë¡œ ë¡œë“œ
const wfRes = await fetch('/workflows/bg_remove.json');
const wf = await wfRes.json();

// Line 182-184: LoadImage ë…¸ë“œì— íŒŒì¼ëª… ì„¤ì •
for (const id in wf) {
  if (wf[id].class_type === 'LoadImage') wf[id].inputs.image = filename;
}

// Line 185: AI ì‘ì—… ì‹œì‘
const pid = await queuePrompt(wf);  // ë°˜í™˜: "prompt_abc123"
```

---

#### ğŸ“Š ì§„í–‰ë¥  í™•ì¸ (Code Line 157-171, 78-97)

**ë™ì‘**: WebSocketìœ¼ë¡œ ì‹¤ì‹œê°„ ì§„í–‰ë¥ ì„ ë°›ê³ , 2ì´ˆë§ˆë‹¤ í´ë§ìœ¼ë¡œ ì‘ì—… ì™„ë£Œ ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

> **í´ë§(Polling)**: ì¼ì • ì‹œê°„ë§ˆë‹¤ ì„œë²„ì— "ì‘ì—… ëë‚¬ì–´?" í•˜ê³  ë¬¼ì–´ë³´ëŠ” ë°©ì‹

**í•µì‹¬ ì½”ë“œ (WebSocket)**:
```typescript
// Line 157: WebSocket ì—°ê²°
wsRef.current = new WebSocket(`ws://127.0.0.1:8188/ws?clientId=${clientId}`);

// Line 166: ì§„í–‰ë¥  ê³„ì‚°
const percent = Math.round((data.data.value / data.data.max) * 100);

// Line 167-168: ìµœì í™” í•„í„° (1% ë¯¸ë§Œ ë³€í™” skip, 200ms ë‚´ ì¤‘ë³µ skip)
if (Math.abs(percent - lastProgressRef.current) < 1) return;
if (now - lastUpdateRef.current < 200) return;
```

**í•µì‹¬ ì½”ë“œ (í´ë§)**:
```typescript
// Line 80: 2ì´ˆë§ˆë‹¤ ìƒíƒœ ì¡°íšŒ
const res = await fetch(`/api/comfy/history/${currentPromptId}`);

// Line 88-90: ê²°ê³¼ ì´ë¯¸ì§€ ë°œê²¬ ì‹œ
if (node.images && node.images.length > 0) {
  const url = `/api/comfy/view?filename=${img.filename}...`;
  setResult(url);  // ê²°ê³¼ URL ì„¤ì •
}
```

---

#### âœ… ê²°ê³¼ ë‹¤ìš´ë¡œë“œ (Code Line 199-209, 251-263)

**ë™ì‘**: Before/After ìŠ¬ë¼ì´ë”ë¡œ ì›ë³¸ê³¼ ê²°ê³¼ë¥¼ ë¹„êµí•˜ê³ , ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í´ë¦­ ì‹œ íŒŒì¼ì„ ì €ì¥í•©ë‹ˆë‹¤.

**í•µì‹¬ ì½”ë“œ**:
```typescript
// Line 251-263: ReactCompareSliderë¡œ ë¹„êµ í‘œì‹œ
<ReactCompareSlider
  itemOne={<ReactCompareSliderImage src={preview} />}
  itemTwo={<ReactCompareSliderImage src={result} />}
/>

// Line 202-206: ë‹¤ìš´ë¡œë“œ ì²˜ë¦¬
const res = await fetch(result);
const blob = await res.blob();
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url; a.download = 'removed-background.png';
a.click();
```

---

### 3. íŒŒì´í”„ë¼ì¸ ìƒì„¸ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [1] íŒŒì¼ ì„ íƒ ë° ì „ì²˜ë¦¬      â”‚
â”‚ Code Line 119-136           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
    [ì´ë¯¸ì§€ ì„ íƒ] â†’ [ê²€ì¦] â†’ [ì •ì‚¬ê°í˜• ë³€í™˜] â†’ [ë¯¸ë¦¬ë³´ê¸°]


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [2] ì„œë²„ ì—…ë¡œë“œ              â”‚
â”‚ Code Line 139-146           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
    [FormData ìƒì„±] â†’ [POST /api/comfy/upload] â†’ [íŒŒì¼ëª… ë°˜í™˜]


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [3] AI ì›Œí¬í”Œë¡œ ì‹¤í–‰         â”‚
â”‚ Code Line 177-186           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
    [ì›Œí¬í”Œë¡œ ë¡œë“œ] â†’ [íŒŒì¼ëª… êµì²´] â†’ [POST /api/comfy/prompt] â†’ [ì‘ì—… ID]


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [4] ì‹¤ì‹œê°„ ì§„í–‰ë¥  ì¶”ì  (2ì±„ë„ ë™ì‹œ)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ WebSocket   â”‚          â”‚   í´ë§      â”‚
       â”‚ Line 157-171â”‚          â”‚ Line 78-97  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“                        â†“
         [progress]             [2ì´ˆë§ˆë‹¤ history]
              â†“                        â†“
       [1%+ & 200ms]             [ì´ë¯¸ì§€ ë°œê²¬?]
              â†“                        â†“
          [UI ì—…ë°ì´íŠ¸]  â†â”€â”€â”€â”€â†’  [ê²°ê³¼ URL ì„¤ì •]


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [5] ê²°ê³¼ í‘œì‹œ ë° ë‹¤ìš´ë¡œë“œ    â”‚
â”‚ Code Line 199-209, 251-263  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
    [Before/After ë¹„êµ] â†’ [ë‹¤ìš´ë¡œë“œ í´ë¦­] â†’ [Blob ë³€í™˜] â†’ [íŒŒì¼ ì €ì¥]
```

---

### ì‹¤ìŠµ ê³¼ì œ

1. ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ ì—´ê¸° (F12)
2. **Network íƒ­** ì„ íƒ
3. ì´ë¯¸ì§€ ì„ íƒ â†’ "ë°°ê²½ ì œê±°" í´ë¦­
4. **API í˜¸ì¶œ ìˆœì„œ í™•ì¸í•˜ê¸°**:
   
   **a. Fetch/XHR í•„í„° í´ë¦­** (ìƒë‹¨ í•„í„° ë²„íŠ¼)
   > Fetch/XHR: ì„œë²„ì™€ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ëŠ” ìš”ì²­ë§Œ í‘œì‹œí•˜ëŠ” í•„í„°
   
   **b. ë‹¤ìŒ ìˆœì„œë¡œ ìš”ì²­ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤** (ìœ„â†’ì•„ë˜):
   
   ```
   â‘  upload
      â†’ ì´ë¯¸ì§€ íŒŒì¼ ì „ì†¡
   
   â‘¡ prompt
      â†’ AI ì‘ì—… ì‹œì‘ ëª…ë ¹
   
   â‘¢ 79f55dc4-48e2-43bc... (ê¸´ ID)
      â†’ history í´ë§ (2ì´ˆë§ˆë‹¤ ë°˜ë³µ, ì—¬ëŸ¬ ê°œ ë‚˜íƒ€ë‚¨)
      â†’ "ì‘ì—… ëë‚¬ì–´?" í™•ì¸
   
   â‘£ view?filename=ComfyUI_00014_...
      â†’ ê²°ê³¼ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
   ```

5. Console íƒ­ì—ì„œ WebSocket ë©”ì‹œì§€ í™•ì¸
6. ì§„í–‰ë¥  ë°” í™•ì¸ (ë¹ ë¥¸ ì²˜ë¦¬ ì‹œ ëˆˆìœ¼ë¡œ í™•ì¸ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŒ)

---

**Part 1 ì™„ë£Œ**